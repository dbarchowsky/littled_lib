!function(t){let e="/vendor/dbarchowsky/littled_cms/ajax/scripts/",i={allowSorting:!0,editThumbnailURL:e+"images/upload_image.php",linkThumbnailURL:e+"images/set_thumbnail.php",unlinkThumbnailURL:e+"images/unlink_thumbnail.php",deleteThumbnailURL:e+"images/del_image.php",albumListingsURL:e+"images/album_listings.php",galleryListingsURL:e+"images/gallery_listings.php",albumContainer:"",errorContainer:".alert-error:first",statusContainer:".alert-info:first",navigationContainer:".page-links-container",albumFiltersSelector:".album-filters",dialogContainer:"#globalDialog",csrfSelector:"#csrf-token",imageDialogClass:"gallery-dialog",postGalleryUpdateCB:null,dom:{album_container:".album-listings",album_filters:".album-filters form:first",gallery_container:".gallery-listings",gallery_filters:".listings-filters",page_error_container:".alert-error:first",error_container:".alert-error",status_container:"alert-info:first",dialog_container:"tk",filters_form:".album-filters form:first",csrf_selector:"#csrf-token"},listings:{album_listings_uri:"tk",gallery_listings_uri:"tk",album_container:"tk",navigation_container:"tk",album_filters_container:"tk"},thumbnails:{edit_uri:"tk",link_uri:"tk",unlink_uri:"tk",delete_uri:"tk"},edit:{id_param:"abid",title_param:"abti",slug_param:"AlbumSlug",class_param:"type",class_key:"class",csrf_key:"csrf",validate_slug_uri:e+"utils/validate_slug.php"},keys:{keyword_filter:"flkw",record_id:"id",content_type_id:"tid",parent_id:"pid",album_page:"p",gallery_page:"ip",operation:"op",csrf:"csrf"},previews:{rolloverSelector:".gal-ro",className:"tip-darkgray",alignTo:"target",alignX:"right",alignY:"center",offsetX:8,followCursor:!0,content:function(){let e=t(".tooltip-content",t(this).parent().parent());return e.length<1&&updateCallback("Preview unavailable!"),e.html()}}},l={retrieveGallery:function(e){let l=t.extend(!0,{},i,e||{});return this.each(function(){let a=t(this),n=a.data(l.keys.parent_id),r=a.data(l.keys.content_type_id);if(!n)return void t(l.dom.page_error_container).littled("displayError","Parent not set.");if(!r)return void t(l.dom.page_error_container).littled("displayError","Content type not set.");!1===l.hasOwnProperty("galleryFilters")&&(l.galleryFilters={});let o=t.extend({},l.galleryFilters,{pid:n,tid:r});o[l.edit.csrf_key]=t(l.csrfSelector).html(),t.littled.retrieveContentOperations(r,function(r){let d=r.ajax_listings_uri||t.littled.getRelativePath()+i.galleryListingsURL;t.post(d,o,function(i){i.error?t(l.dom.page_error_container).littled("displayError",i.error):(a.html(t.littled.htmldecode(i.content)),a.galleries("bindGalleryHandlers",e),l.hasOwnProperty("animate")&&!0===l.animate&&t("tr.gallery-row[data-id="+n+"]").galleries("animateGalleryToggle",e))},"json").success(function(){l.postGalleryUpdateCB&&l.postGalleryUpdateCB.apply(this,arguments)}).fail(function(e){0!==e.status&&t(l.dom.page_error_container).littled("ajaxError",e)})})})},toggleGallery:function(e,l){let a=t.extend(!0,{},i,l||{}),n=t(this).data("id"),r=t(this).button("option","icons"),o=t("tr.gallery-row[data-id="+n+"]");if(o.length<1)t(a.dom.page_error_container).littled("displayError","Gallery could not be located.");else if("ui-icon-expand"===r.primary){if(t(a.dom.gallery_container+" table:first",o).length<1){let e,i=t(a.dom.album_filters);i.length>0&&(e=i.serializeObject({},["pl","next","filt"]));let l=t.extend({},{pid:n},e||{});t(a.dom.gallery_container,o).galleries("retrieveGallery",{galleryFilters:l,animate:!0})}else{let e=t(a.dom.gallery_container,o);!1===e.hasClass("functional")&&e.galleries("bindGalleryHandlers"),o.galleries("animateGalleryToggle",l),o.galleries("configureSorting",l)}}else o.galleries("animateGalleryToggle",l)},animateGalleryToggle:function(e){let l=t.extend(!0,{},i,e||{});return this.each(function(){let e=t(this).data("id"),i=t("#toggle-"+e+"-btn");if("ui-icon-expand"===i.button("option","icons").primary)i.button("option","icons",{primary:"ui-icon-collapse"}),t(this).show(),t(l.dom.gallery_container,t(this)).slideToggle("slow");else{t(l.dom.gallery_container,t(this)).slideToggle("",function(){t(this).hide()});let e=t(l.dom.gallery_container+" table:first",t(this));e.length>0&&e.hasClass("ui-sortable")&&e.sortable("destroy"),i.button("option","icons",{primary:"ui-icon-expand"})}})},bindAlbumListingsHandlers:function(e){let a=t.extend(!0,{},i,e||{});return this.each(function(){t(this).unbind("contentUpdate",l.updateAlbumListingsHandlers).bind("contentUpdate",a,l.updateAlbumListingsHandlers).keywords("bindListingsHandlers").off("click","tr.list",l.toggleListHighlight).on("click","tr.list",l.toggleListHighlight).off("click","tr.list-alt",l.toggleListHighlightAlt).on("click","tr.list-alt",l.toggleListHighlightAlt).off("click",".alb-nav",l.gotoAlbumPage).on("click",".alb-nav",e,l.gotoAlbumPage).off("click",".toggle-pages-btn",l.toggleGallery).on("click",".toggle-pages-btn",l.toggleGallery).off("click",".add-page-btn",l.editImage).on("click",".add-page-btn",e,l.editImage).off("click",".add-page-link",l.editImage).on("click",".add-page-link",e,l.editImage).off("click",".update-cache-btn",t.littled.updateCache).on("click",".update-cache-btn",{errorContainer:a.dom.error_container,statusContainer:a.statusContainer},t.littled.updateCache).off("dblclick",".inline-edit-cell",l.editCell).on("dblclick",".inline-edit-cell",e,l.editCell).off("galleryLoaded",".pages-row",l.retrieveGallery).on("galleryLoaded",".pages-row",e,l.retrieveGallery),!0===a.allowSorting&&t(this).galleries("bindAlbumResorting",e),t(".details-btn",t(this)).iconButton("details"),t(".edit-btn",t(this)).iconButton("edit"),t(".print-btn",t(this)).iconButton("print"),t(".trash-btn",t(this)).iconButton("trash"),t(".preview-btn",t(this)).iconButton("link"),t(".toggle-pages-btn",t(this)).iconButton("expand"),t(".add-page-btn",t(this)).iconButton("addchild"),t(".update-cache-btn",t(this)).iconButton("cache"),t(a.previews.rolloverSelector,t(this)).poshytip(a.previews),t(".img-details-link",t(this)).formDialog({dialogClass:a.imageDialogClass,dom:{listings_container:a.dom.album_container}}),t(".trash-btn",t(this)).formDialog({dialogClass:"ui-dialog-delete",dom:{listings_container:a.dom.album_container}}),t(a.dom.gallery_container).addClass("hidden")})},updateAlbumListingsHandlers:function(e){t(this).galleries("bindAlbumListingsHandlers",e.data||{})},bindGalleryHandlers:function(e){let a=t.extend(!0,{},i,e||{});return this.each(function(){t(this).off("contentUpdate",l.updateGalleryHandlers).on("contentUpdate",a,l.updateGalleryHandlers).galleries("bindFilterElementsHandlers",e).galleries("configureSorting",e).galleries("bindImageOverlayHandlers",e).keywords("bindListingsHandlers",e).off("dblclick",".inline-edit-cell",l.editCell).on("dblclick",".inline-edit-cell",l.editCell).off("click",".add-img-btn",l.editImage).on("click",".add-img-btn",e,l.editImage).off("click",".edit-img-btn",l.editImage).on("click",".edit-img-btn",e,l.editImage).off("click",".update-cache_btn",t.littled.updateCache).on("click",".update-cache_btn",{errorContainer:a.dom.error_container,statusContainer:a.statusContainer},t.littled.updateCache).off("click",".gal-nav",l.gotoGalleryPage).on("click",".gal-nav",e,l.gotoGalleryPage).addClass("functional");let i={dialogClass:a.imageDialogClass,formLoadCB:function(){let e=t(a.dialogContainer+":visible");e.length<1||t(".image-detail").on("click",function(t){t.preventDefault(),e.formDialog("close")})},dom:{listings_container:a.dom.gallery_container}};t(".img-details-btn",t(this)).iconButton("details").formDialog(i),t(".img-details-link",t(this)).formDialog(i),t(".add-img-btn",t(this)).iconButton("addchild"),t(".edit-img-btn",t(this)).iconButton("edit"),t(".delete-img-btn",t(this)).iconButton("trash").formDialog({dialogClass:"ui-dialog-delete",dom:{listings_container:a.dom.gallery_container},callbacks:{update_content:l.updateGalleryListingsContent}}),jQuery().poshytip&&t(a.previews.rolloverSelector,t(this)).poshytip(a.previews),t(".datepicker",t(this)).datepicker()})},updateGalleryHandlers:function(e){let l=t.extend(!0,{},i,e||{});t(this).galleries("bindGalleryHandlers"),l.postGalleryUpdateCB&&l.postGalleryUpdateCB.apply(this,arguments)},updateGalleryListingsContent:function(e){let l=t.extend(!0,{},i,e.settings||{}).dom.gallery_container+"[data-pid="+e.parent_id+"]";e.settings={dom:{listings_container:l}},t(l).listings("updateListingsContent",e)},bindImageOverlayHandlers:function(e){let a=t.extend(!0,{},i,e||{});return this.each(function(){t(this).off("contentUpdate",l.updateImageOverlayHandlers).on("contentUpdate",a,l.updateImageOverlayHandlers).off("click",".img-upload-btn",l.updateThumbnail).on("click",".img-upload-btn",e,l.updateThumbnail).off("click",".sel-galltn-btn",l.updateThumbnail).on("click",".sel-galltn-btn",e,l.updateThumbnail).off("click",".add-img-btn",l.editImage).on("click",".add-img-btn",e,l.editImage).off("click",".gallery-edit",l.bindGalleryEditButtons).off("dblclick",".gallery-edit",l.detailsDialog).on("click",".gallery-edit",e,l.bindGalleryEditButtons).on("dblclick",".gallery-edit",e,l.detailsDialog).off("click",".gallery-tn-container",l.bindThumbnailEditButtons).off("dblclick",".gallery-tn-container",l.detailsDialog).on("click",".gallery-tn-container",e,l.bindThumbnailEditButtons).on("dblclick",".gallery-tn-container",e,l.detailsDialog),t(".img-upload-btn",t(this)).button(),t(".sel-galltn-btn",t(this)).button(),t(".add-img-btn",t(this)).iconButton("addchild")})},updateImageOverlayHandlers:function(e){t(this).galleries("bindImageOverlayHandlers",e.data||{})},bindGalleryEditButtons:function(){let e=t("#img-overlay-btns");if(e.length<1)return;let i=t(this);i.addClass("active-edit"),t("#edit-overlay-btn").off("click",l.editImage).on("click",l.editImage),t("#edit-overlay-btn").data("id",i.data("id")),t("#edit-overlay-btn").data("pid",i.data("pid")),t("#edit-overlay-btn").data("tid",i.data("tid")),t("#del-overlay-btn").data("id",i.data("id")),t("#del-overlay-btn").data("pid",i.data("pid")),t("#del-overlay-btn").data("tid",i.data("tid")),t("#del-overlay-btn").formDialog({dialogClass:"ui-dialog-delete"});let a=i.offset();e.css("top",a.top+6).css("left",a.left+6).show(),setTimeout(function(){i.removeClass("active-edit"),t("#edit-overlay-btn").off("click",l.editImage),t("#del-overlay-btn").formDialog("cancel"),e.hide()},4e3)},bindThumbnailEditButtons:function(e){e.preventDefault();let i=e.data||{},a=t("#tn-overlay-btns");if(a.length<1)return;t(this).addClass("active-edit");let n=t("#edit-galltn-btn"),r=t("#del-galltn-btn");n.on("click",i,l.updateThumbnail),r.on("click",i,l.updateThumbnail),n.data("id",t(this).data("id")),n.data("pid",t(this).data("pid")),n.data("tid",t(this).data("tid")),n.data("op",t(this).data("op")),n.data("rand",t(this).data("rand")),r.data("id",t(this).data("id")),r.data("pid",t(this).data("pid")),r.data("tid",t(this).data("tid")),r.data("op","del-"+t(this).data("op"));let o=t(this).offset();a.css("top",o.top+6).css("left",o.left+6).show();let d=t(this);setTimeout(function(){d.removeClass("active-edit"),n.off("click",l.updateThumbnail),r.off("click",l.updateThumbnail),a.hide()},4e3)},bindSlugWatch:function(e){let a=t.extend(!0,{},i,e||{});return this.on("blur",a,l.validateSlug)},validateSlug:function(e){let l=t.extend(!0,{},i,e.data||{});t(this).closest("div").children(".alert-error:visible").fadeOut("fast");let a=t(this).closest("form"),n={};n[l.edit.csrf_key]=t(l.csrfSelector).html(),n[l.edit.id_param]=t('input[name="'+l.edit.id_param+'"]',a).val(),n[l.edit.title_param]=t('input[name="'+l.edit.title_param+'"]',a).val(),n[l.edit.slug_param]=t('input[name="'+l.edit.slug_param+'"]',a).val(),n[l.edit.class_key]=t('input[name="'+l.edit.class_param+'"]',a).val(),n[l.edit.id_param]||t(this).attr("name")===l.edit.slug_param&&(n[l.edit.title_param]=n[l.edit.slug_param],n[l.edit.slug_param]=""),t.post(l.edit.validate_slug_uri,n,function(e){if(e.content){t('input[name="'+l.edit.slug_param+'"]',a).val(e.content)}if(e.error)if(e.content){let i=$i.closest("div"),l=t(".alert-error",i);if(l.length<1){let e=t('<div class="alert alert-error hidden"></div>');i.prepend(e)}l.html(e.error),l.fadeIn("slow")}else t(l.dom.error_container).littled("displayError",e.error)},"json").fail(function(e){t(l.dom.error_container).littled("ajaxError",e)})},editImage:function(e){e.preventDefault(),e.hasOwnProperty("data")&&delete e.data;let i=l.getListingsSelector.apply(this,e.data);e.data={dom:{listings_container:i}},t(this).formDialog("open",e)},getListingsSelector:function(e){let l=t.extend(!0,{},i,e||{});return l.dom.gallery_container+"[data-"+l.keys.parent_id+"="+t(this).data(l.keys.parent_id)+"]"},editCell:function(e){e.stopPropagation(),t(this).listings("editCell",e)},updateThumbnail:function(e){e.preventDefault();let a=e.data||{},n=t.extend(!0,{},i,a),r=t(this).data("op"),o=t(this).formDialog("retrieveFormFilters",e.data||{});if("upload"!==r&&"del-upload"!==r&&void 0===o.pid||void 0===o.tid)return void t(n.dom.error_container).littled("displayError","Gallery properties not set.");o[n.edit.csrf_key]=t(n.csrfSelector).html();let d=l.getThumbnailURI(r,n);t.post(d,o,function(e){let i={formLoadCB:l.displayThumbnailDialog};0===r.indexOf("del")&&(i.dialogClass="ui-dialog-delete"),e.settings=t.extend(!0,{},a,i),!1===t(n.dialogContainer).is(":visible")&&t(n.dialogContainer).formDialog("display",e)},"json").fail(function(e){t(n.dom.error_container).littled("ajaxError",e)})},displayThumbnailDialog:function(e){let a=t.extend(!0,{},i,e||{});t(a.dialogContainer+" .dlg-commit-btn").off("click"),t(a.dialogContainer+" .dlg-commit-btn").on("click",e,l.commitThumbnailUpdate)},commitThumbnailUpdate:function(e){e.preventDefault();let a,n=t.extend(!0,{},i,e.data||{}),r=t(n.dialogContainer+" form:first"),o=t("input[name=op]",r);if(o.length&&(a=o.val()),!a)return void t(n.dom.error_container).littled("displayError","Operation not specified.");let d=l.getThumbnailURI(a,n);"select"===a?t.post(d,r.serializeObject(),function(t){t.options=e.data||{},l.processThumbnailUpdate(t)},"json").fail(function(e){t(n.dom.error_container).formDialog("ajaxError",e)}):r.ajaxSubmit({type:"post",url:d,dataType:"json",success:function(t){t.options=e.data||{},l.processThumbnailUpdate(t)},error:function(e){t(n.dom.error_container).littled("ajaxError",e)}})},processThumbnailUpdate:function(e){let l=t.extend(!0,{},i,e.options||{});if(e.error)t(l.dom.error_container).littled("displayError",e.error);else if(t(l.dialogContainer).formDialog("close"),e.container_id){let i=t(e.container_id);i.length&&(i.html(t.littled.htmldecode(e.content)),t(e.container_id).galleries("bindImageOverlayHandlers"))}},getThumbnailURI:function(e,l){let a=t.extend(!0,{},i,l||{});switch(e){case"upload":case"edit":return t.littled.getRelativePath()+a.editThumbnailURL;case"link":case"select":return t.littled.getRelativePath()+a.linkThumbnailURL;case"unlink":case"del-link":return t.littled.getRelativePath()+a.unlinkThumbnailURL;case"delete":case"del-upload":return t.littled.getRelativePath()+a.deleteThumbnailURL;default:return t(a.dom.error_container).littled("displayError","Unhandled operation."),""}},deleteRecord:function(t){},collectPageNavigationVariables:function(e){let l=t.extend(!0,{},i,e||{}),a={};return a[l.keys.album_page]=t(this).data(l.keys.album_page),a[l.keys.content_type_id]=t(l.dom.album_container+" table:first").data(l.keys.content_type_id),null===a[l.keys.content_type_id]&&(a[l.keys.content_type_id]=t(l.dom.album_container).data(l.keys.content_type_id)),a[l.keys.parent_id]=t(l.dom.album_container+" table:first").data(l.keys.parent_id),a},validatePageNavigationVariables:function(e,l){let a=t.extend(!0,{},i,l||{});return null!==e[a.keys.content_type_id]||(t(a.dom.error_container).littled("displayError","Content type could not be determined through the attributes of the listings container, or the first table nested in the container."),!1)},gotoAlbumPage:function(e){e.preventDefault();let l=e.data||{},a=t.extend(!0,{},i,l),n=t(this).galleries("collectPageNavigationVariables",l);if(!1===t(this).galleries("validatePageNavigationVariables",n,l))return;t(".sm-process-wheel").addClass("sm-active-wheel"),t("#status-container").fadeOut("fast");let r=t(a.dom.album_filters).littled("collectFormDataWithCSRF",e.data||{},n);t.littled.retrieveContentOperations(r[a.keys.content_type_id],function(e){if(e.error)return void t(a.dom.error_container).littled("displayError",e.error);let i=t.littled.getRelativePath()+a.albumListingsURL;e.ajax_listings_uri&&(i=e.ajax_listings_uri),t.ajax({type:"post",url:i,data:r,dataType:"json"}).success(function(e){e.settings=l,e.page=n[a.keys.album_page],t(a.dom.album_container).galleries("updateAlbumContent",e)}).fail(function(e){t(a.dom.error_container).littled("ajaxError",e)})})},updateAlbumContent:function(e){let l=t.extend(!0,{},i,e.settings||{});if(e.error)return void t(l.dom.error_container).littled("displayError",e.error);let a=e.hasOwnProperty("page")?e.page:1;a||(a=1),t(".sm-process-wheel").removeClass("sm-active-wheel");let n=t.Event("contentUpdate");n.data=e.settings||{},t(l.dom.album_container).html(t.littled.htmldecode(e.content)),t(l.dom.album_container).data("p",a).trigger(n)},gotoGalleryPage:function(e){e.preventDefault();let l=e.data||{},a=t.extend(!0,{},i,l),n=t(this).parents(a.dom.gallery_container+":first"),r=t(a.dom.gallery_filters,n),o={};o[a.keys.parent_id]=n.data(a.keys.parent_id),o[a.keys.album_page]=t(this).data(a.keys.album_page),t("input[name="+a.keys.gallery_page+"]",r).val(o[a.keys.album_page]);let d=t.extend({},o,t("input, select",r).serializeObject());n.galleries("retrieveGallery",t.extend(!0,{},l,{galleryFilters:d,animate:!1}))},configureSorting:function(e){t.extend(!0,{},i,e||{});return this.each(function(){let e=t("table:first",t(this));e.length>0?e.sortable({items:"tr.page-row",update:function(e,i){t(this).resort("resort",e,i)}}):t(this).is("div")&&t(this).sortable({items:".page-cell",update:function(e,i){t(this).resort("resort",e,i)}})})},bindFilterElementsHandlers:function(e){let a=t.extend(!0,{},i,e||{});return this.each(function(){let i=t(".gallery-page-nav:first",t(this));t("input[name="+a.keys.keyword_filter+"]",i).keypress(function(e){13===(window.event?window.event.keyCode:e.which)&&t(".gallery-filter-btn:first",i).trigger("click")}),t(".gallery-filter-btn:first",i).button().off("click",l.submitGalleryFilters).on("click",e,l.submitGalleryFilters)})},bindAlbumResorting:function(e){let a=t.extend(!0,{},i,e||{});return this.each(function(){let i=!1,n=t(a.dom.filters_form);if(n.length>0){let t=n.serializeObject();i=l.hasFilteredListings(t)}!1===i&&t("table:first",t(this)).resort("bindResort",e)})},submitGalleryFilters:function(e){e.preventDefault();let l=e.data||{},a=t.extend(!0,{},i,e.data||{}),n=t(this).closest("form"),r=t("input, select",n).serializeObject();r.hasOwnProperty(a.keys.gallery_page)&&delete r[a.keys.gallery_page],n.closest(a.dom.gallery_container).galleries("retrieveGallery",t.extend(!0,{},l,{galleryFilters:r,animate:!1}))},hasFilteredListings:function(e){let i,l=t.extend({},{p:"",pl:"",filt:"",ifilt:"",next:"",inext:"",ip:"",ipl:""});for(i in e)if(e.hasOwnProperty(i)&&!1===l.hasOwnProperty(i)&&Object.prototype.hasOwnProperty.call(e,i))return!!e[i];return!1},toggleListHighlight:function(){t(this).toggleClass("md")},toggleListHighlightAlt:function(){t(this).toggleClass("md-alt")},bindDialogHandlers:function(){return this.each(function(){t(".dlg-commit-btn",t(this)).button().on("click",cb),t(".dlg-cancel-btn",t(this)).button().on("click",LITTLED.cancel),t(".datepicker",t(this)).datepicker()})}};t.fn.galleries=function(e){return l[e]?l[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.galleries."),!1):l.init.apply(this,arguments)}}(jQuery);